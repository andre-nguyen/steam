//////////////////////////////////////////////////////////////////////////////////////////////
/// \file SteamSingerTrajPriorFactor.hpp
///
/// \author Jeremy Wong, ASRL
//////////////////////////////////////////////////////////////////////////////////////////////

#ifndef STEAM_SINGER_TRAJECTORY_PRIOR_FACTOR_HPP
#define STEAM_SINGER_TRAJECTORY_PRIOR_FACTOR_HPP

#include <Eigen/Core>

#include <steam/trajectory_singer/SteamSingerTrajInterface.hpp>
#include <steam/evaluator/ErrorEvaluator.hpp>

namespace steam {
namespace se3 {

//////////////////////////////////////////////////////////////////////////////////////////////
/// \brief Gaussian-process prior evaluator
//////////////////////////////////////////////////////////////////////////////////////////////
class SteamSingerTrajPriorFactor : public ErrorEvaluatorX
{
 public:

  /// Shared pointer typedefs for readability
  typedef boost::shared_ptr<SteamSingerTrajPriorFactor> Ptr;
  typedef boost::shared_ptr<const SteamSingerTrajPriorFactor> ConstPtr;

  //////////////////////////////////////////////////////////////////////////////////////////////
  /// \brief Constructor
  //////////////////////////////////////////////////////////////////////////////////////////////
  SteamSingerTrajPriorFactor(const SteamSingerTrajVar::ConstPtr& knot1,
                       const SteamSingerTrajVar::ConstPtr& knot2, const Eigen::Matrix<double,6,6>& alpha, const Eigen::Matrix<double,6,6>& alpha_inv);

  //////////////////////////////////////////////////////////////////////////////////////////////
  /// \brief Returns whether or not an evaluator contains unlocked state variables
  //////////////////////////////////////////////////////////////////////////////////////////////
  virtual bool isActive() const;

  //////////////////////////////////////////////////////////////////////////////////////////////
  /// \brief Evaluate the GP prior factor
  //////////////////////////////////////////////////////////////////////////////////////////////
  virtual Eigen::VectorXd evaluate() const;

  //////////////////////////////////////////////////////////////////////////////////////////////
  /// \brief Evaluate the GP prior factor and Jacobians
  //////////////////////////////////////////////////////////////////////////////////////////////
  virtual Eigen::VectorXd evaluate(const Eigen::MatrixXd& lhs, std::vector<Jacobian<> >* jacs) const;

 private:

  //////////////////////////////////////////////////////////////////////////////////////////////
  /// \brief First (earlier) knot
  //////////////////////////////////////////////////////////////////////////////////////////////
  SteamSingerTrajVar::ConstPtr knot1_;

  //////////////////////////////////////////////////////////////////////////////////////////////
  /// \brief Second (later) knot
  //////////////////////////////////////////////////////////////////////////////////////////////
  SteamSingerTrajVar::ConstPtr knot2_;

  Eigen::Matrix<double,6,6> alpha_;
  Eigen::Matrix<double,6,6> alpha_inv_;
};

} // se3
} // steam

#endif // STEAM_SINGER_TRAJECTORY_PRIOR_FACTOR_HPP

